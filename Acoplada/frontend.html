<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frontend CRUD - MiTablaDynamoDB (clave ID)</title>
  <style>
    :root{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{max-width:1100px;margin:24px auto;font-size:15px;color:#111}
    header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
    h1{font-size:20px;margin:0}
    .card{border:1px solid #e6e6e6;border-radius:8px;padding:12px;margin:8px 0;background:#fff;box-shadow:0 1px 2px rgba(0,0,0,0.03)}
    label{display:block;font-size:13px;margin:6px 0}
    input[type=text], input[type=url]{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px}
    button{padding:8px 12px;border-radius:6px;border:none;background:#0b74de;color:#fff;cursor:pointer;margin-right:8px}
    button.secondary{background:#666}
    pre{background:#f7f7f7;padding:8px;border-radius:6px;overflow:auto;max-height:260px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    .note{font-size:13px;color:#555}
  </style>
</head>
<body>
  <header>
    <h1>Frontend CRUD - MiTablaDynamoDB (clave ID)</h1>
    <div class="note">Endpoints: POST /items, GET /items, GET /items/{id}, PUT /items/{id}, DELETE /items/{id}</div>
  </header>

  <section class="card">
    <strong>Configuración</strong>
    <label>Base URL de la API (ej: <code>https://mi-api.execute-api.region.amazonaws.com/prod</code>)</label>
    <input id="baseUrl" type="url" placeholder="https://..." value="" />
  </section>

  <div class="grid">
    <!-- Crear -->
    <section class="card">
      <strong>Crear elemento (POST /items)</strong>
      <label>ID</label><input id="create_id" type="text" placeholder="Ej: 123" />
      <label>Nombre</label><input id="create_nombre" type="text" placeholder="Ej: Camiseta roja" />
      <label>Fecha</label><input id="create_fecha" type="text" placeholder="Ej: 2025-11-03" />
      <label>Cantidad</label><input id="create_cantidad" type="text" placeholder="Ej: 10" />
      <div><button id="btnCreate">Crear</button><button class="secondary" id="btnCreateClear">Borrar campos</button></div>
    </section>

    <!-- Obtener por ID -->
    <section class="card">
      <strong>Obtener por ID (GET /items/{id})</strong>
      <label>ID</label><input id="read_id" type="text" placeholder="Ej: 123" />
      <div><button id="btnRead">Obtener</button><button class="secondary" id="btnReadClear">Limpiar</button></div>
    </section>

    <!-- Obtener todos -->
    <section class="card">
      <strong>Obtener todos (GET /items)</strong>
      <div><button id="btnReadAll">Obtener todos</button><button class="secondary" id="btnReadAllClear">Limpiar salida</button></div>
    </section>

    <!-- Actualizar -->
    <section class="card">
      <strong>Actualizar elemento (PUT /items/{id})</strong>
      <label>ID</label><input id="update_id" type="text" placeholder="Ej: 123" />
      <label>Nombre</label><input id="update_nombre" type="text" placeholder="Nuevo nombre" />
      <label>Fecha</label><input id="update_fecha" type="text" placeholder="Nueva fecha" />
      <label>Cantidad</label><input id="update_cantidad" type="text" placeholder="Nueva cantidad" />
      <div><button id="btnUpdate">Actualizar</button><button class="secondary" id="btnUpdateClear">Limpiar</button></div>
    </section>

    <!-- Eliminar -->
    <section class="card">
      <strong>Eliminar elemento (DELETE /items/{id})</strong>
      <label>ID</label><input id="delete_id" type="text" placeholder="Ej: 123" />
      <div><button id="btnDelete">Eliminar</button><button class="secondary" id="btnDeleteClear">Limpiar</button></div>
    </section>

    <!-- Salida -->
    <section class="card full">
      <strong>Salida / Respuestas</strong>
      <pre id="output">Aquí aparecerán las respuestas de la API (JSON).</pre>
    </section>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    function showOutput(obj){ $('output').textContent = JSON.stringify(obj, null, 2); }
    function baseApi(){ return $('baseUrl').value.trim().replace(/\/+$/,''); }

    async function callApi(path, opts = {}) {
      const base = baseApi(); 
      if(!base){ showOutput({error:'Falta Base URL'}); return; }
      const url = base + (path.startsWith('/')?path:'/'+path);
      opts.headers = {'Content-Type':'application/json'};
      if(opts.body && typeof opts.body === 'object') opts.body = JSON.stringify(opts.body);
      try {
        const res = await fetch(url, opts);
        const data = await res.json().catch(()=>res.text());
        showOutput({url,status:res.status,ok:res.ok,data});
        return data;
      } catch(err) {
        showOutput({error: err.message});
        return null;
      }
    }

    // CREATE
    $('btnCreate').onclick = ()=> {
      const idValue = $('create_id').value.trim();
      if(!idValue){ showOutput({error:'ID vacío, debe ser un string válido'}); return; }
      const body = {
        id: String(idValue),
        nombre: $('create_nombre').value,
        cantidad: parseInt($('create_cantidad').value) || 0
      };
      if($('create_fecha').value) body.fecha = $('create_fecha').value;
      console.log("POST body:", body);
      callApi('/items',{method:'POST',body});
    };
    $('btnCreateClear').onclick = ()=>['create_id','create_nombre','create_fecha','create_cantidad'].forEach(i=>$(i).value='');

    // READ ONE
    $('btnRead').onclick = async () => {
      const idValue = $('read_id').value.trim();
      if(!idValue){ showOutput({error:'ID vacío, debe ser un string válido'}); return; }
      const data = await callApi(`/items/${String(idValue)}`, {method:'GET'});
      if(data && data.nombre){
        $('update_id').value = data.id || '';
        $('update_nombre').value = data.nombre || '';
        $('update_fecha').value = data.fecha || '';
        $('update_cantidad').value = data.cantidad != null ? data.cantidad : '';
      }
    };
    $('btnReadClear').onclick = ()=>['read_id'].forEach(i=>$(i).value='');

    // READ ALL
    $('btnReadAll').onclick = ()=> callApi('/items',{method:'GET'});
    $('btnReadAllClear').onclick = ()=> showOutput({});

    // UPDATE
    $('btnUpdate').onclick = ()=> {
      const idValue = $('update_id').value.trim();
      if(!idValue){ showOutput({error:'ID vacío, debe ser un string válido'}); return; }
      const body = {
        nombre: $('update_nombre').value,
        cantidad: parseInt($('update_cantidad').value) || 0
      };
      if($('update_fecha').value) body.fecha = $('update_fecha').value;
      callApi(`/items/${String(idValue)}`,{method:'PUT',body});
    };
    $('btnUpdateClear').onclick = ()=>['update_id','update_nombre','update_fecha','update_cantidad'].forEach(i=>$(i).value='');

    // DELETE
    $('btnDelete').onclick = ()=> {
      const idValue = $('delete_id').value.trim();
      if(!idValue){ showOutput({error:'ID vacío, debe ser un string válido'}); return; }
      callApi(`/items/${String(idValue)}`,{method:'DELETE'});
    };
    $('btnDeleteClear').onclick = ()=>['delete_id'].forEach(i=>$(i).value='');

  </script>
</body>
</html>
